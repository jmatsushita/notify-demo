apiVersion: 1.0.0
metadata:
  name: notify-demo-devfile
projects:
  - name: backend
    source:
      type: git
      location: https://github.com/jmatsushita/notify-demo.git
attributes:
  persistVolumes: false
components:
  - alias: theia-editor
    type: cheEditor
    id: eclipse/che-theia/next
  - alias: backend
    type: kubernetes
    referenceContent: |
      kind: List
      items:
      -
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: notify-demo-deployment
        spec:
          replicas: 1
          selector:
            matchLabels:
              my-workspace-pod: dev
          template:
            metadata:
              name: dev-pod
              labels:
                my-workspace-pod: dev
            spec:
              containers:
              - image: jmatsushita/iris:latest
                name: iris
                env:
                - name: IRIS_CFG_DB_HOST
                  value: db
                - name: IRIS_CFG_DB_PASSWORD
                  value: password
                - name: IRIS_CFG_DB_USER
                  value: iris
                ports:
                - containerPort: 16649
                volumeMounts:
                - name: config-volume
                  mountPath: /home/iris/config/config.yaml
                  subPath: iris.config.dev.yaml
              - image: jmatsushita/iris-relay:latest
                name: iris-relay
                ports:
                - containerPort: 16648
                volumeMounts:
                - name: config-volume
                  mountPath: /home/iris/config/config.yaml
                  subPath: iris-relay.config.dev.yaml
              - image: kristophjunge/test-saml-idp:1.15
                name: saml-idp
                env:
                - name: SIMPLESAMLPHP_ADMIN_PASSWORD
                  value: test
                - name: SIMPLESAMLPHP_SECRET_SALT
                  value: salt
                - name: SIMPLESAMLPHP_SP_ASSERTION_CONSUMER_SERVICE
                  value: http://localhost:16648/saml/sso/idp
                - name: SIMPLESAMLPHP_SP_ENTITY_ID
                  value: iris
                - name: SIMPLESAMLPHP_SP_SINGLE_LOGOUT_SERVICE
                  value: http://localhost:16648/saml/sso/idp
                ports:
                - containerPort: 8080
                - containerPort: 8443
                volumeMounts:
                - name: config-volume
                  mountPath: /var/www/simplesamlphp/config/authsources.php
                  subPath: authsources.php
              - image: mysql:5.7
                name: db
                env:
                - name: MYSQL_DATABASE
                  value: iris
                - name: MYSQL_PASSWORD
                  value: password
                - name: MYSQL_ROOT_PASSWORD
                  value: test
                - name: MYSQL_USER
                  value: iris
                ports:
                - containerPort: 3306
                volumeMounts:
                - name: config-volume
                  mountPath: /docker-entrypoint-initdb.d/0_schema.sql
                  subPath: 0_schema.sql
                - name: config-volume
                  mountPath: /docker-entrypoint-initdb.d/1_schema.sql
                  subPath: 1_schema.sql
                - name: config-volume
                  mountPath: /docker-entrypoint-initdb.d/dummy_data.sql
                  subPath: dummy_data.sql
              volumes:
              - name: config-volume
                configMap:
                  name: notify-demo-config
      -
        apiVersion: v1
        kind: ConfigMap
        metadata:
          name: notify-demo-config
        data:
          my-key: my-value
          iris.config.dev.yaml: |
            #####################
            ### Iris-api settings
            #####################
            server:
              host: 0.0.0.0
              port: 16649
              disable_auth: True # allow logins by existing users, but without checking credentials
              local_api_url: http://localhost:16649

            db: &db
              conn:
                kwargs:
                  scheme: mysql+pymysql
                  user: root
                  password: ""
                  host: 127.0.0.1
                  database: iris
                  charset: utf8
                str: "%(scheme)s://%(user)s:%(password)s@%(host)s/%(database)s?charset=%(charset)s"
              query_limit: 500
              kwargs:
                pool_recycle: 3600
                echo: False
                pool_size: 100
                max_overflow: 100
                pool_timeout: 60

            ## Change these to random long values when you run this in production
            user_session:
              encrypt_key: 'abc'
              sign_key: '123'

            supported_timezones:
              - 'US/Pacific'
              - 'US/Eastern'
              - 'US/Central'
              - 'US/Mountain'
              - 'US/Alaska'
              - 'US/Hawaii'
              - 'Asia/Kolkata'
              - 'Asia/Shanghai'
              - 'UTC'

            healthcheck_path: /tmp/status

            allowed_origins:
              - http://localhost:8080

            ## values for base url and login url to be consumed by the mobile app
            ## set to Null to disable the qr endpoint
            qr_base_url: Null
            qr_login_url: Null

            ## Custom webhooks can be created and put in src/iris/webhooks.
            ## Refer to their class name in this array.
            ## The webhook will be available at /v0/webhooks/$name and requires being called with
            ## ?application=xxx&key=xxx
            #webhooks: []

            #####################
            ### Iris-sender
            #####################
            sender:
              debug: True # Set to True, sender will not actually send messages
              process_title: iris-sender
              host: 127.0.0.1
              port: 2321

              ## Number of gevent workers per mode we send
              workers_per_mode:
                email: 500
                #hipchat: 10

              ## Default sender to reach out to if we can't determine one programmatically
              master_sender:
                host: 127.0.0.1
                port: 2321

              api_host: http://localhost:16649

              ## App used for sending notification messages + incidents
              sender_app: iris
              ## RPC access log
              access_log:
                maxBytes: 10485760
                filename: './logs/sender_rpc.access.log'

              ## Optionally, use zookeeper for sender high availability.
              #zookeeper_cluster: localhost:2181

              # Disable the gmail based iris-sender watchdog process
              disable_gwatch_renewer: True

              ## If you're not using zookeeper, the following determines
              ## whether this sender is a master and you hard code in
              ## slaves to be cycled through
              is_master: True

            #slaves:
            #  - host: 127.0.0.1
            #    port: 2322
            #  - host: 127.0.0.1
            #    port: 2323

            sender_workers: 1000

            ## Enabled modules for resolving complex user roles to individual usernames, processed
            ## in the order listed here.
            role_lookups:
              - user # support for 'role' being username
              - mailing_list # mailing list config; see bottom of file
              #- oncall # oncall service integration
              - dummy # dummy role lookup used for testing purposes. Disable this in production.

            oncall-api: http://localhost:8080  # oncall url
            oncall-app: app # application for oncall auth
            oncall-key: abc # API key for oncall auth

            applications:
             - dummy_app

            ## Vendors provides a way to add support for new notification mechanisms
            vendors: []
            #- type: iris_smtp
            #  name: email
            #  smtp_server: 'smtp1.example.com'
            #  smtp_gateway: 'smtp2.example.com'
            #  from: 'foouser@example.com'
            #  port: 25
            #  username: 'foobar'
            #  password: 'secretpass'

            ## If True, make a pool of persistent connections per each MX record for the given smtp_gateway
            ##  autoscale: False
            ##  tasks_per_mx: 4

            #- type: iris_slack
            #  name: slack
            #  auth_token: ''
            #  base_url: 'https://slack.com/api/chat.postMessage'
            #  iris_incident_url: ''
            #  proxy: *proxy_shared
            #  message_attachments:
            #    fallback: 'Iris Alert Fired!'
            #    color: 'danger'
            #    pretext: '<!here> _Iris_ _Alert!_'

            #- type: iris_twilio
            #  name: twilio_1
            #  account_sid: ''
            #  auth_token: ''
            #  twilio_number: ''
            #  relay_base_url: ''

            ## Hipchat support requires adding a new mode called "hipchat", in iris' mode table
            ## Also, uncomment the hipchat workers to the sender['workers_per_mode'] hash above
            ## Messages will be sent to $room_id by default, with @UserName getting a mention
            ## Note that we support 3 different values for a users hipchat value:
            ## 1. @UserName
            ## 2. room_id;token
            ## 3. room_id;token;@UserName
            #- type: iris_hipchat
            #  name: hipchat
            #  auth_token: 'mytoken'
            #  debug: False
            #  base_url: 'https://api.hipchat.com'
            #  room_id: 1234567

            ## Metrics
            metrics: dummy # output metrics to logs
            #metrics: prometheus
            #prometheus:
            #  iris-sync-targets:
            #    server_port: 8001
            #  iris-sender:
            #    server_port: 8002
            #
            #
            #metrics: influx
            #influxdb:
            #  connect:
            #    host: localhost
            #    port: 8086
            #    database: iris

            ## Claim incidents by clicking the link in gmail.
            ## See https://developers.google.com/gmail/markup/reference/one-click-action
            enable_gmail_oneclick: False
            gmail_one_click_url_key: 'foo'
            gmail_one_click_url_endpoint: 'http://localhost:16648/api/v0/gmail-oneclick/relay'

            #####################
            ### Iris-sync-targets
            #####################
            sync_script_nap_time: 3600 # wait time before syncing again
            ## use this for LDAP settings for sync script lookup
            # init_config_hook: iris_internal.api.init_config

            ## always create these users
            # sync_script: # always create these users
            #   preset_users:
            #     - name: 'dummy'
            #       sms: '0123456789'
            #       call: '0123456789'
            ## Optionally, import ldap mailing lists and have the ability to target them in messages
            #ldap_lists:
            #  connection:
            #    url: 'ldaps://your ldap url'
            #    bind_args: ['your bind username', 'your bind password']
            #  search_strings:
            #    get_all_lists_filter: '(&(objectClass=group)(groupCN=*)(groupName=*))'
            #    get_all_sub_lists_filter: '(&(objectClass=group)(partOf=%s)(groupCN=*)(groupName=*))'
            #    list_search_string: 'OU=groups,OU=company,DC=com'
            #    user_search_string: 'OU=users,OU=company,DC=com'
            #    user_membership_filter: '(&(objectClass=user)(userName=*)(partOf=%s))'
            #    user_mail_field: 'userName'
            #    list_cn_field: 'groupCN'
            #    list_name_field: 'groupName'
            #
            #  # Max depth for recursing nested ldap lists.
            #  max_depth: 3
            #
            #  # If a list result returns at least this many results, don't support unrolling at runtime.
            #  max_unrolled_users: 100
            #
            #  # Every $n users, stop inserting into mysql to avoid crashing it. Comment these out to disable.
            #  user_add_pause_interval: 500
            #  user_add_pause_duration: 1

            #####################
            ### Iris-owa-sync
            #####################
            ## To sync mails from OWA365:
            #owa:
            #  credentials:
            #    username: 'foouser@example.com'
            #    password: ''
            #  account:
            #    autodiscover: false  # needs to be False for OWA365
            #    primary_smtp_address: foouser@example.com
            #  config:
            #    server: outlook.office365.com  # need to hardcode this for OWA365
            ### proxies are optional but you can configure them here
            ##  proxies:
            ##    https: http://yourproxy:yourport
            ##    http: http://yourproxy:yourport
            #  # need a valid iris application for for owa script to connect to api to relay emails
            #  iris_app: ''
            #  iris_app_key: ''
            #  api_host: http://localhost:16649
            #  sleep_interval: 60
            #

            #####################
            ### Iris-process-retention
            #####################
            ## To automatically prune DB of messages & incidents older than $x days
            #
            #retention:
            #  enabled: True
            #  max_days: 180  # Max age of incidents/messages to kill
            #  archive_path: /path/to/iris/backup  # Path to be populated with the deleted messages/incidents for later reference
            #  batch_size: 10000  # Do this many incidents/messages at a time, to avoid overloading mysql
            #  cooldown_time: 1  # Wait this many seconds between iterations of above
            #  run_interval: 86400  # Run retention loop every this many seconds
            #
            #iris-mobile:
            #  activated: False
            #  devices_allowed_apps:
            #    - iris-relay
          iris-relay.config.dev.yaml: |
            server:
              host: 0.0.0.0
              port: 16648
              # debug: True
              enable_basic_auth: False
              basic_auth:
                iris_twilio_user: 'barbaz'
              # lb_routing_path: '/iris-relay'
            allow_origins_list:
             - http://localhost:8080
             - http://localhost:8100
             - http://localhost:35729
             - http://localhost
             - http://localhost/
            twilio:
              remote_host: 'localhost:11648'
              auth_token: 'foobar'
            slack:
              verification_token: 'foo'
              response_text: 'Alert claimed.'
            iris:
              relay_app_name: 'iris-relay'
              host: localhost
              port: 16649
              api_key: 'foo'
              hook:
                gmail: 'response/gmail'
                gmail_one_click: 'response/gmail-oneclick'
                twilio_calls: 'response/twilio/calls'
                twilio_messages: 'response/twilio/messages'
                twilio_status: 'twilio/deliveryupdate'
                slack: 'response/slack'
            iris-mobile:
              relay_app_name: 'iris-mobile'
              activated: True
              host: 'localhost'
              port: 16649
              api_key: 'foo'
              auth:
                time_window: 90
                access_ttl: 28800
                refresh_ttl: 604800
                redirect_url: 'http://localhost:7000'
                username_attr: sAMAccountName
                # Example key; change in production
                encrypt_key: iizL8s_AqSBwZO-xzJ0bFt_kMSg6A8OsTAMON2gqpII=
              oncall:
                activated: True
                host: 'http://localhost:8080'
                port: 8080
                api_key: 'foo'
            gmail:
              project: iris-1234
              push_endpoint: https://www.fooo.bar/iris-relay/api/v0/gmail/relay
              scope:
                - https://mail.google.com/
                - https://www.googleapis.com/auth/pubsub
              sub: iris@foo.bar
              topic: iris_gmail_push
              subscription: gmail
              creds: './configs/client_secret.apps.googleusercontent.com.json'
              var_dir: './var'
              verification_code: googleabcdefg.html
              token: lbbc1797daaaaaaavaa6d3f0aad45e66
            gmail_one_click_url_key: 'foo'
            healthcheck_path: /tmp/relay_health
            db:
              conn:
                kwargs:
                  scheme: mysql+pymysql
                  user: root
                  host: 127.0.0.1
                  database: 'iris'
                  charset: utf8
                  echo: True
                str: "%(scheme)s://%(user)s@%(host)s/%(database)s?charset=%(charset)s"
              kwargs:
                pool_recycle: 3600

            saml:
              metadata_url_for:
                idp: 'https://www.metadata.com'
              acs_format: 'http://host:16648/saml/sso/%s'
              https_acs_format: 'https://host/saml/sso/%s'
          authsources.php: |
            <?php
            $config = array(
                'admin' => array(
                    'core:AdminPassword',
                ),
                'example-userpass' => array(
                    'exampleauth:UserPass',
                    'demo:demo' => array(
                        'uid' => array('1'),
                        'eduPersonAffiliation' => array('group1'),
                        'email' => 'demo1@foo.bar',
                        'login' => 'demo',
                    ),
                    'user2:user2pass' => array(
                        'uid' => array('2'),
                        'eduPersonAffiliation' => array('group2'),
                        'email' => 'user2@example.com',
                        'login' => 'user2',
                    ),
                ),
            );
          dummy_data.sql: |
            /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
            -- DEFAULT DB VALUES
            LOCK TABLES `mode` WRITE;
            INSERT INTO `mode` VALUES (26,'call'),(35,'email'),(17,'slack'),(8,'sms'),(36,'drop');
            UNLOCK TABLES;

            LOCK TABLES `priority` WRITE;
            INSERT INTO `priority` VALUES (8,'urgent',26),(17,'high',8),(26,'medium',35),(35,'low',35);
            UNLOCK TABLES;

            LOCK TABLES `target_type` WRITE;
            INSERT INTO `target_type` VALUES (3,'mailing-list'),(2,'team'),(1,'user');
            UNLOCK TABLES;

            LOCK TABLES `target_role` WRITE;
            INSERT INTO `target_role` VALUES
                (8,'user',1),
                (17,'manager',2),
                (35,'team',2),
                (44,'oncall-primary',2),
                (45,'oncall-secondary',2);
            UNLOCK TABLES;

            -- END DEFAULT DB VALUES

            LOCK TABLES `application` WRITE;
            INSERT INTO `application` VALUES
                (8,'Autoalerts','a7a9d7657ac8837cd7dfed0b93f4b8b864007724d7fa21422c24f4ff0adb2e49','{{#context}}\n<div style=\"text-align: center;\">\n    <a href=\"{{console_url}}\" style=\"margin-right: 10px;\">{{name}}</a>\n    <div style=\"margin-bottom: 10px;\">\n      <small>\n        <span style=\"margin-right: 10px;\">\n          <span class=\"light\">Datacenter:</span> {{fabric}}\n        </span>\n        <span>\n          <span class=\"light\">Zones:</span> {{zones}}\n        </span>\n      </small>\n    </div>\n    {{#if nodes}}\n      <p><small><span class=\"light\">Nodes:</span> {{#each nodes}} {{this}} {{/each}}</small></p>\n    {{/if}}\n    {{#if notes}}\n      <p>Notes: {{notes}}</p>\n    {{/if}}\n  </div>\n</div>\n{{/context}}','{{#context}}\n<ul>\n  {{#if name}}\n    <li data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{name}}\">\n      <strong> Name: </strong> {{name}}\n    </li>\n  {{/if}}\n  {{#if filename}}\n    <li data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{filename}}\">\n      <strong> Dashboard: </strong> {{filename}}\n    </li>\n  {{/if}}\n  {{#if fabric}}\n    <li data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{fabric}}\">\n      <strong>Fabric: </strong> {{fabric}}\n    </li>\n  {{/if}}\n  {{#if zones}}\n   <li data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{zones}}\">\n    <strong>Zones: </strong> {{zones}}\n   </li>\n  {{/if}}\n  {{#if nodes}}\n    <li>\n      <strong>Nodes: </strong>\n      <ul>\n        {{#each nodes}}\n          <li data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{this}}\"> {{this}} </li>\n        {{/each}}\n      </ul>\n    </li>\n  {{/if}}\n</ul>\n{{/context}}\n','{\n  \"console_url\": \"\",\n  \"fabric\": \"DC1\",\n  \"filename\": \"dashboard\",\n  \"graph_image_url\": \"http://url.example.com/foo\",\n  \"metanodes\": [\n    [\"execution_time.metanode1\", \"threshold: 72 is greater than the max (65)\"]\n  ],\n  \"name\": \"Name Of Your Alert\",\n  \"nodes\": [\n    [\"execution_time.server1.example.com\", \"threshold: 72 is greater than the max (65)\"]\n  ],\n  \"notes\": \"This is a note\",\n  \"zones\": [\"zone1\", \"zone2\"]\n}',NULL,0,0,0,NULL),
                (10,'test-app','sdffdssdf',NULL,NULL,NULL,NULL,0,0,0,NULL),
                (11,'iris','fooooo',NULL,NULL,NULL,NULL,1,1,1,NULL),
                (12,'oncall','magic','','','{}',NULL,0,0,0,NULL);
            UNLOCK TABLES;

            LOCK TABLES `application_mode` WRITE;
            INSERT INTO `application_mode` VALUES
                (8,8),
                (8,17),
                (8,26),
                (8,35),
                (10,8),
                (10,17),
                (10,26),
                (10,35),
                (11,8),
                (11,17),
                (11,26),
                (11,35),
                (12,8),
                (12,17),
                (12,26),
                (12,35);
            UNLOCK TABLES;

            LOCK TABLES `application_owner` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `application_quota` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `default_application_mode` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `dynamic_plan_map` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `generic_message_sent_status` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `incident` WRITE;
            INSERT INTO `incident` VALUES
                (1,40,'2017-01-25 23:22:55','2017-01-25 23:24:55','{\"console_url\": \"\", \"fabric\": \"DC1\", \"notes\": \"This is a note\", \"filename\": \"dashboard\", \"zones\": [\"zone1\", \"zone2\"], \"metanodes\": [[\"execution_time.metanode1\", \"threshold: 72 is greater than the max (65)\"]], \"nodes\": [[\"execution_time.server1.example.com\", \"threshold: 72 is greater than the max (65)\"]], \"graph_image_url\": \"http://url.example.com/foo\", \"name\":\"API Alert\"}',1,8,1,0),
                (2,40,'2017-01-25 23:22:55','2017-01-25 23:24:55','{\"console_url\": \"\", \"fabric\": \"DC1\", \"notes\": \"This is a note\", \"filename\": \"dashboard\", \"zones\": [\"zone1\", \"zone2\"], \"metanodes\": [[\"execution_time.metanode1\", \"threshold: 72 is greater than the max (65)\"]], \"nodes\": [[\"execution_time.server1.example.com\", \"threshold: 72 is greater than the max (65)\"]], \"graph_image_url\": \"http://url.example.com/foo\", \"name\":\"API Alert\"}',1,8,1,0),
                (3,40,'2017-01-25 23:22:55','2017-01-25 23:24:55','{\"console_url\": \"\", \"fabric\": \"DC1\", \"notes\": \"This is a note\", \"filename\": \"dashboard\", \"zones\": [\"zone1\", \"zone2\"], \"metanodes\": [[\"execution_time.metanode1\", \"threshold: 72 is greater than the max (65)\"]], \"nodes\": [[\"execution_time.server1.example.com\", \"threshold: 72 is greater than the max (65)\"]], \"graph_image_url\": \"http://url.example.com/foo\", \"name\":\"API Alert\"}',1,8,1,0);
            UNLOCK TABLES;

            LOCK TABLES `incident_emails` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `mailing_list` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `mailing_list_membership` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `message` WRITE;
            INSERT INTO `message` VALUES
                (1,NULL,'2017-01-25 23:23:55','2017-01-25 23:24:55',8,1,'demo1@foo.bar',35,40,35,'email_subject','email_body',1,33,0,13),
                (2,'10018616db1e4cceba3a9f69177c2343','2017-01-29 23:23:55','2017-01-25 23:24:55',8,1,'demo1@foo.bar',35,40,35,'email_subject','email_body',2,33,0,13),
                (3,'10018616db1e4cceba3a9f69177c2343','2017-01-29 23:23:55','2017-01-25 23:24:55',8,1,'demo1@foo.bar',35,40,35,'email_subject','email_body',3,33,0,13);
            UNLOCK TABLES;

            LOCK TABLES `message_changelog` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `plan` WRITE;
            INSERT INTO `plan` VALUES
                (1,'demo-test-foo','2017-01-25 23:23:55',1,NULL,'Test plan for e2e test',2,900,10,300,300,NULL,NULL,NULL),
                (7,'demo-test-incident-post','2017-01-25 23:23:55',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (8,'demo-test-incident-post','2017-01-25 23:23:56',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (11,'demo-test-foo','2017-01-25 23:25:46',1,NULL,'Test plan for e2e test',2,900,10,300,300,NULL,NULL,NULL),
                (17,'demo-test-incident-post','2017-01-25 23:25:46',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (18,'demo-test-incident-post','2017-01-25 23:25:46',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (21,'demo-test-foo','2017-01-25 23:26:44',1,NULL,'Test plan for e2e test',2,900,10,300,300,NULL,NULL,NULL),
                (27,'demo-test-incident-post','2017-01-25 23:26:44',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (28,'demo-test-incident-post','2017-01-25 23:26:45',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (31,'demo-test-foo','2017-01-25 23:30:34',1,NULL,'Test plan for e2e test',2,900,10,300,300,NULL,NULL,NULL),
                (37,'demo-test-incident-post','2017-01-25 23:30:34',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (38,'demo-test-incident-post','2017-01-25 23:30:34',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (39,'demo-test-other-app-incident-post','2017-01-25 23:30:34',1,NULL,'Test plan for e2e test',1,900,10,300,300,NULL,NULL,NULL),
                (40,'demo-test-bar','2017-01-25 23:25:46',1,NULL,'Test plan for e2e email incident test',1,900,10,300,300,NULL,NULL,NULL),
                (41,'Oncall test','2018-01-26 22:32:04',1,NULL,'Test plan for Oncall Iris integration',1,900,10,300,300,NULL,NULL,NULL);
            UNLOCK TABLES;

            LOCK TABLES `plan_active` WRITE;
            INSERT INTO `plan_active` VALUES
                ('demo-test-foo',31),
                ('demo-test-incident-post',38),
                ('demo-test-other-app-incident-post',39),
                ('demo-test-bar',40),
                ('Oncall test',41);
            UNLOCK TABLES;

            LOCK TABLES `plan_notification` WRITE;
            INSERT INTO `plan_notification` VALUES
                (1,1,1,'test_template',4,0,44,17,1,300,NULL),
                (2,1,1,'test_template',4,0,35,35,0,600,NULL),
                (3,1,2,'test_template',4,0,35,26,0,600,NULL),
                (4,1,2,'test_template',4,0,44,8,1,300,NULL),
                (5,7,1,'test_template',4,0,35,35,0,600,NULL),
                (6,7,1,'test_template',4,0,44,17,1,300,NULL),
                (7,8,1,'test_template',4,0,35,35,0,600,NULL),
                (9,11,1,'test_template',4,0,44,17,1,300,NULL),
                (10,11,1,'test_template',4,0,35,35,0,600,NULL),
                (11,11,2,'test_template',4,0,35,26,0,600,NULL),
                (12,11,2,'test_template',4,0,44,8,1,300,NULL),
                (13,17,1,'test_template',4,0,35,35,0,600,NULL),
                (14,17,1,'test_template',4,0,44,17,1,300,NULL),
                (15,18,1,'test_template',4,0,35,35,0,600,NULL),
                (17,21,1,'test_template',4,0,44,17,1,300,NULL),
                (18,21,1,'test_template',4,0,35,35,0,600,NULL),
                (19,21,2,'test_template',4,0,35,26,0,600,NULL),
                (20,21,2,'test_template',4,0,44,8,1,300,NULL),
                (21,27,1,'test_template',4,0,35,35,0,600,NULL),
                (22,27,1,'test_template',4,0,44,17,1,300,NULL),
                (23,28,1,'test_template',4,0,35,35,0,600,NULL),
                (25,31,1,'test_template',4,0,44,17,1,300,NULL),
                (26,31,1,'test_template',4,0,35,35,0,600,NULL),
                (27,31,2,'test_template',4,0,35,26,0,600,NULL),
                (28,31,2,'test_template',4,0,44,8,1,300,NULL),
                (29,37,1,'test_template',4,0,35,35,0,600,NULL),
                (30,37,1,'test_template',4,0,44,17,1,300,NULL),
                (31,38,1,'test_template',4,0,35,35,0,600,NULL),
                (32,39,1,'test_template_2',4,0,35,35,0,600,NULL),
                (33,40,1,'test_template',4,0,35,35,0,600,NULL),
                (34,41,1,'oncall-test',NULL,0,NULL,26,0,0,2),
                (35,41,1,'oncall-test',NULL,0,NULL,26,0,0,1),
                (36,41,1,'oncall-test',NULL,0,NULL,8,0,0,0);
            UNLOCK TABLES;

            LOCK TABLES `response` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `target` WRITE;
            INSERT INTO `target` VALUES
                (1,'demo',1,1),
                (2,'abc',1,1),
                (3,'foo',1,1),
                (4,'demo_team',2,1),
                (5,'foo_team',2,1),
                (6,'abc',3,1),
                (7,'demo',3,1);
            UNLOCK TABLES;

            LOCK TABLES `mailing_list_membership` WRITE;
            INSERT INTO `mailing_list_membership` VALUES
                (7,1);
            UNLOCK TABLES;

            LOCK TABLES `target_application_mode` WRITE;
            INSERT INTO `target_application_mode` VALUES
                (1,8,26,26);
            UNLOCK TABLES;

            LOCK TABLES `target_contact` WRITE;
            INSERT INTO `target_contact` VALUES
                (1,8,'+1 223-456-7890'),
                (1,17,'demo1'),
                (1,26,'+1 223-456-7890'),
                (1,35,'demo1@foo.bar'),
                (2,8,'+1 223-456-7891'),
                (2,17,'demo2'),
                (2,26,'+1 223-456-7891'),
                (2,35,'demo2@foo.bar'),
                (3,8,'+1 223-456-7892'),
                (3,17,'demo3'),
                (3,26,'+1 223-456-7892'),
                (3,35,'demo3@foo.bar');
            UNLOCK TABLES;

            LOCK TABLES `target_mode` WRITE;
            INSERT INTO `target_mode` VALUES
                (1,26,26);
            UNLOCK TABLES;

            LOCK TABLES `target_reprioritization` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `team` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `template` WRITE;
            INSERT INTO `template` VALUES
                (12,'test_template','2017-01-25 15:26:45',1),
                (13,'test_template','2017-01-25 15:30:35',1),
                (14,'test_template_2','2017-01-25 15:30:35',1),
                (15,'oncall-test','2018-01-26 14:31:19',1);
            UNLOCK TABLES;

            LOCK TABLES `template_active` WRITE;
            INSERT INTO `template_active` VALUES
                ('test_template',13),
                ('test_template_2',14),
                ('oncall-test',15);
            UNLOCK TABLES;

            LOCK TABLES `template_content` WRITE;
            INSERT INTO `template_content` VALUES
                (12,8,8,'','a',NULL,NULL,NULL,NULL,NULL,NULL),
                (12,8,17,'','b',NULL,NULL,NULL,NULL,NULL,NULL),
                (12,8,26,'','c',NULL,NULL,NULL,NULL,NULL,NULL),
                (12,8,35,'email_subject','d',NULL,NULL,NULL,NULL,NULL,NULL),
                (13,8,8,'','test_sms',NULL,NULL,NULL,NULL,NULL,NULL),
                (13,8,17,'','test_slack',NULL,NULL,NULL,NULL,NULL,NULL),
                (13,8,26,'','test_call',NULL,NULL,NULL,NULL,NULL,NULL),
                (13,8,35,'email_subject','email_body',NULL,NULL,NULL,NULL,NULL,NULL),
                (14,10,35,'email_subject','email_body',NULL,NULL,NULL,NULL,NULL,NULL),
                (15,12,8,'','{{requester}} reports: {{description}}',NULL,NULL,NULL,NULL,NULL,NULL),
                (15,12,17,'','{{requester}} reports: {{description}}',NULL,NULL,NULL,NULL,NULL,NULL),
                (15,12,26,'','{{requester}} reports: {{description}}',NULL,NULL,NULL,NULL,NULL,NULL),
                (15,12,35,'Oncall escalation','{{requester}} reports: {{description}}',NULL,NULL,NULL,NULL,NULL,NULL);
            UNLOCK TABLES;

            LOCK TABLES `template_variable` WRITE;
            INSERT INTO `template_variable` VALUES
                (1,8,'fabric',0, 0),
                (2,8,'console_url',0, 0),
                (3,8,'filename',0, 0),
                (4,8,'name',0, 0),
                (5,8,'graph_image_url',0, 0),
                (7,8,'zones',0, 0),
                (8,8,'nodes',0, 0),
                (9,8,'metanodes',0, 0),
                (10,8,'notes',0, 0),
                (11,12,'description',0, 0),
                (12,12,'requester',0, 0);
            UNLOCK TABLES;

            LOCK TABLES `twilio_delivery_status` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `twilio_retry` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `user` WRITE;
            INSERT INTO `user` VALUES
                (1,1),
                (2,0),
                (3,0);
            UNLOCK TABLES;

            LOCK TABLES `user_setting` WRITE;
            UNLOCK TABLES;

            LOCK TABLES `user_team` WRITE;
            UNLOCK TABLES;
            /*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
          0_schema.sql: |
            -- MySQL dump 10.13  Distrib 5.1.73, for redhat-linux-gnu (x86_64)
            --
            -- Host: localhost    Database: iris
            -- ------------------------------------------------------
            -- Server version	5.1.73

            /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
            /*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
            /*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
            /*!40101 SET NAMES utf8 */;
            /*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
            /*!40103 SET TIME_ZONE='+00:00' */;
            /*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
            /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
            /*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
            /*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

            --
            -- Table structure for table `application`
            --

            CREATE SCHEMA IF NOT EXISTS `iris` DEFAULT CHARACTER SET utf8;
            USE `iris`;

            DROP TABLE IF EXISTS `application`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `application` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              `key` varchar(64) NOT NULL,
              `context_template` text,
              `summary_template` text,
              `sample_context` text,
              `mobile_template` text,
              `auth_only` tinyint(1) DEFAULT '0',
              `allow_other_app_incidents` tinyint(1) unsigned NOT NULL DEFAULT '0',
              `allow_authenticating_users` tinyint(1) unsigned NOT NULL DEFAULT '0',
              `secondary_key` varchar(64),
              PRIMARY KEY (`id`),
              UNIQUE KEY `name_idx` (`name`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `incident`
            --

            DROP TABLE IF EXISTS `incident`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `incident` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `plan_id` bigint(20) NOT NULL,
              `created` datetime NOT NULL,
              `updated` datetime DEFAULT NULL,
              `context` text,
              `owner_id` bigint(20) DEFAULT NULL,
              `application_id` int(11) NOT NULL,
              `current_step` int(11) NOT NULL,
              `active` tinyint(1) NOT NULL,
              PRIMARY KEY (`id`),
              KEY `ix_incident_plan_id` (`plan_id`),
              KEY `ix_incident_updated` (`updated`),
              KEY `ix_incident_owner_id` (`owner_id`),
              KEY `ix_incident_active` (`active`),
              KEY `ix_incident_application_id` (`application_id`),
              KEY `ix_incident_created` (`created`),
              CONSTRAINT `incident_ibfk_1` FOREIGN KEY (`plan_id`) REFERENCES `plan` (`id`),
              CONSTRAINT `incident_ibfk_2` FOREIGN KEY (`owner_id`) REFERENCES `user` (`target_id`),
              CONSTRAINT `incident_ibfk_3` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `message`
            --

            DROP TABLE IF EXISTS `message`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `message` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `batch` varchar(32) DEFAULT NULL,
              `created` datetime NOT NULL,
              `sent` datetime DEFAULT NULL,
              `application_id` int(11) NOT NULL,
              `target_id` bigint(20) NOT NULL,
              `destination` varchar(255) DEFAULT NULL,
              `mode_id` int(11) DEFAULT NULL,
              `plan_id` bigint(20) DEFAULT NULL,
              `priority_id` int(11) NOT NULL,
              `subject` varchar(255) DEFAULT NULL,
              `body` text,
              `incident_id` bigint(20) DEFAULT NULL,
              `plan_notification_id` bigint(20) DEFAULT NULL,
              `active` tinyint(1) NOT NULL DEFAULT '1',
              `template_id` int(11) DEFAULT NULL,
              PRIMARY KEY (`id`),
              KEY `plan_id` (`plan_id`),
              KEY `ix_message_sent` (`sent`),
              KEY `ix_message_created` (`created`),
              KEY `ix_message_incident_id` (`incident_id`),
              KEY `ix_message_plan_notification_id` (`plan_notification_id`),
              KEY `ix_message_priority_id` (`priority_id`),
              KEY `ix_message_batch` (`batch`),
              KEY `ix_message_application_id` (`application_id`),
              KEY `ix_message_target_id` (`target_id`),
              KEY `ix_message_mode_id` (`mode_id`),
              KEY `ix_message_active` (`active`),
              KEY `message_ibfk_8` (`template_id`),
              CONSTRAINT `message_ibfk_1` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`),
              CONSTRAINT `message_ibfk_2` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`),
              CONSTRAINT `message_ibfk_3` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`),
              CONSTRAINT `message_ibfk_4` FOREIGN KEY (`plan_id`) REFERENCES `plan` (`id`),
              CONSTRAINT `message_ibfk_5` FOREIGN KEY (`priority_id`) REFERENCES `priority` (`id`),
              CONSTRAINT `message_ibfk_6` FOREIGN KEY (`incident_id`) REFERENCES `incident` (`id`),
              CONSTRAINT `message_ibfk_7` FOREIGN KEY (`plan_notification_id`) REFERENCES `plan_notification` (`id`),
              CONSTRAINT `message_ibfk_8` FOREIGN KEY (`template_id`) REFERENCES `template` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            DROP TABLE IF EXISTS `message_changelog`;
            CREATE TABLE `message_changelog` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `date` datetime NOT NULL,
              `message_id` bigint(20) NOT NULL,
              `change_type` varchar(255) NOT NULL,
              `old` varchar(255) NOT NULL,
              `new` varchar(255) NOT NULL,
              `description` varchar(255),
              PRIMARY KEY (`id`),
              KEY `ix_message_changelog_message_id` (`message_id`),
              KEY `ix_message_changelog_date` (`date`),
              CONSTRAINT `message_changelog_ibfk_1` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB;

            --
            -- Table structure for table `mode`
            --

            DROP TABLE IF EXISTS `mode`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `mode` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              PRIMARY KEY (`id`),
              UNIQUE KEY `name_idx` (`name`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `plan`
            --

            DROP TABLE IF EXISTS `plan`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `plan` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              `created` datetime NOT NULL,
              `user_id` bigint(20) NOT NULL,
              `team_id` bigint(20) DEFAULT NULL,
              `description` text,
              `step_count` int(11) NOT NULL,
              `threshold_window` bigint(20) DEFAULT NULL,
              `threshold_count` bigint(20) DEFAULT NULL,
              `aggregation_window` bigint(20) DEFAULT NULL,
              `aggregation_reset` bigint(20) DEFAULT NULL,
              `tracking_key` varchar(255) DEFAULT NULL,
              `tracking_type` varchar(255) DEFAULT NULL,
              `tracking_template` text,
              PRIMARY KEY (`id`),
              KEY `user_id` (`user_id`),
              KEY `team_id` (`team_id`),
              KEY `ix_plan_created` (`created`),
              CONSTRAINT `plan_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`),
              CONSTRAINT `plan_ibfk_2` FOREIGN KEY (`team_id`) REFERENCES `team` (`target_id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `plan_active`
            --

            DROP TABLE IF EXISTS `plan_active`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `plan_active` (
              `name` varchar(255) NOT NULL,
              `plan_id` bigint(20) NOT NULL,
              PRIMARY KEY (`name`),
              UNIQUE KEY `plan_id` (`plan_id`),
              CONSTRAINT `plan_active_ibfk_1` FOREIGN KEY (`plan_id`) REFERENCES `plan` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `plan_notification`
            --

            DROP TABLE IF EXISTS `plan_notification`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `plan_notification` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `plan_id` bigint(20) NOT NULL,
              `step` int(11) NOT NULL,
              `template` varchar(255) DEFAULT NULL,
              `target_id` bigint(20),
              `optional` TINYINT(1) NOT NULL DEFAULT '0',
              `role_id` int(11),
              `priority_id` int(11) NOT NULL,
              `repeat` int(11) NOT NULL DEFAULT '0',
              `wait` int(11) NOT NULL DEFAULT '0',
              `dynamic_index` int(11),
              PRIMARY KEY (`id`),
              KEY `ix_plan_notification_plan_id` (`plan_id`),
              KEY `ix_plan_notification_template` (`template`),
              KEY `ix_plan_notification_role_id` (`role_id`),
              KEY `ix_plan_notification_priority_id` (`priority_id`),
              KEY `ix_plan_notification_target_id` (`target_id`),
              CONSTRAINT `plan_notification_ibfk_1` FOREIGN KEY (`plan_id`) REFERENCES `plan` (`id`),
              CONSTRAINT `plan_notification_ibfk_2` FOREIGN KEY(`template`) REFERENCES `template_active` (`name`) ON UPDATE CASCADE ON DELETE SET NULL,
              CONSTRAINT `plan_notification_ibfk_3` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`),
              CONSTRAINT `plan_notification_ibfk_4` FOREIGN KEY (`role_id`) REFERENCES `target_role` (`id`),
              CONSTRAINT `plan_notification_ibfk_5` FOREIGN KEY (`priority_id`) REFERENCES `priority` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `dynamic_plan_map`
            --

            DROP TABLE IF EXISTS `dynamic_plan_map`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `dynamic_plan_map` (
              `incident_id` bigint(20) NOT NULL AUTO_INCREMENT,
              `dynamic_index` int(11) NOT NULL,
              `role_id` int(11) NOT NULL,
              `target_id` bigint(20) NOT NULL,
              PRIMARY KEY (`incident_id`, `dynamic_index`),
              KEY `ix_dynamic_plan_map_incident_id` (`incident_id`),
              CONSTRAINT `dynamic_plan_map_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`),
              CONSTRAINT `dynamic_plan_map_ibfk_2` FOREIGN KEY (`role_id`) REFERENCES `target_role` (`id`),
              CONSTRAINT `dynamic_plan_map_ibfk_3` FOREIGN KEY (`incident_id`) REFERENCES `incident` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `priority`
            --

            DROP TABLE IF EXISTS `priority`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `priority` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              `mode_id` int(11) NOT NULL,
              PRIMARY KEY (`id`),
              UNIQUE KEY `name_idx` (`name`),
              KEY `ix_priority_mode_id` (`mode_id`),
              CONSTRAINT `priority_ibfk_1` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `response`
            --

            DROP TABLE IF EXISTS `response`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `response` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `created` datetime NOT NULL,
              `message_id` bigint(20) NOT NULL,
              `content` text NOT NULL,
              `source` varchar(255) NOT NULL,
              PRIMARY KEY (`id`),
              KEY `ix_response_message_id` (`message_id`),
              KEY `ix_response_created` (`created`),
              CONSTRAINT `response_ibfk_1` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target`
            --

            DROP TABLE IF EXISTS `target`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target` (
              `id` bigint(20) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              `type_id` int(11) NOT NULL,
              `active` tinyint(1) NOT NULL DEFAULT '1',
              PRIMARY KEY (`id`),
              UNIQUE KEY `name_type_idx` (`name`,`type_id`),
              KEY `active_index` (`active`),
              CONSTRAINT `target_ibfk_1` FOREIGN KEY (`type_id`) REFERENCES `target_type` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target_application_mode`
            --

            DROP TABLE IF EXISTS `target_application_mode`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target_application_mode` (
              `target_id` bigint(20) NOT NULL,
              `application_id` int(11) NOT NULL,
              `priority_id` int(11) NOT NULL,
              `mode_id` int(11) NOT NULL,
              PRIMARY KEY (`target_id`,`application_id`,`priority_id`),
              KEY `application_mode_ibfk_2` (`application_id`),
              KEY `application_mode_ibfk_3` (`priority_id`),
              KEY `application_mode_ibfk_4` (`mode_id`),
              CONSTRAINT `target_application_mode_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `target_application_mode_ibfk_2` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`),
              CONSTRAINT `target_application_mode_ibfk_3` FOREIGN KEY (`priority_id`) REFERENCES `priority` (`id`),
              CONSTRAINT `target_application_mode_ibfk_4` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target_default_application_mode`
            --

            DROP TABLE IF EXISTS `default_application_mode`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `default_application_mode` (
              `application_id` int(11) NOT NULL,
              `priority_id` int(11) NOT NULL,
              `mode_id` int(11) NOT NULL,
              PRIMARY KEY (`application_id`,`priority_id`),
              KEY `default_application_mode_ibfk_1` (`application_id`),
              KEY `default_application_mode_ibfk_2` (`priority_id`),
              KEY `default_application_mode_ibfk_3` (`mode_id`),
              CONSTRAINT `default_application_mode_ibfk_1` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`),
              CONSTRAINT `default_application_mode_ibfk_2` FOREIGN KEY (`priority_id`) REFERENCES `priority` (`id`),
              CONSTRAINT `default_application_mode_ibfk_3` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            --
            -- Table structure for table `target_contact`
            --

            DROP TABLE IF EXISTS `target_contact`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target_contact` (
              `target_id` bigint(20) NOT NULL,
              `mode_id` int(11) NOT NULL,
              `destination` varchar(255) NOT NULL,
              PRIMARY KEY (`target_id`,`mode_id`),
              KEY `ix_target_contact_mode_id` (`mode_id`),
              CONSTRAINT `target_contact_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `target_contact_ibfk_2` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target_mode`
            --

            DROP TABLE IF EXISTS `target_mode`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target_mode` (
              `target_id` bigint(20) NOT NULL,
              `priority_id` int(11) NOT NULL,
              `mode_id` int(11) NOT NULL,
              PRIMARY KEY (`target_id`,`priority_id`),
              KEY `priority_id` (`priority_id`),
              KEY `ix_target_mode_mode_id` (`mode_id`),
              CONSTRAINT `target_mode_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `target_mode_ibfk_2` FOREIGN KEY (`priority_id`) REFERENCES `priority` (`id`),
              CONSTRAINT `target_mode_ibfk_3` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target_reprioritization`
            --

            DROP TABLE IF EXISTS `target_reprioritization`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target_reprioritization` (
              `target_id` bigint(20) NOT NULL,
              `src_mode_id` int(11) NOT NULL,
              `dst_mode_id` int(11) NOT NULL,
              `count` tinyint(5) unsigned NOT NULL,
              `duration` smallint(5) unsigned NOT NULL,
              PRIMARY KEY (`target_id`,`src_mode_id`),
              KEY `target_reprioritization_mode_src_mode_id_fk_idx` (`src_mode_id`),
              KEY `target_reprioritization_mode_dst_mode_id_fk_idx` (`dst_mode_id`),
              CONSTRAINT `target_reprioritization_mode_dst_mode_id_fk` FOREIGN KEY (`dst_mode_id`) REFERENCES `mode` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
              CONSTRAINT `target_reprioritization_mode_src_mode_id_fk` FOREIGN KEY (`src_mode_id`) REFERENCES `mode` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
              CONSTRAINT `target_reprioritization_target_id_fk` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target_role`
            --
            -- Used in plan step, one multiple role can map to same target type
            --

            DROP TABLE IF EXISTS `target_role`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target_role` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              `type_id` int(11) NOT NULL,
              PRIMARY KEY (`id`),
              UNIQUE KEY `name_idx` (`name`),
              KEY `ix_target_role_type_id` (`type_id`),
              CONSTRAINT `target_role_ibfk_1` FOREIGN KEY (`type_id`) REFERENCES `target_type` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `target_type`
            --

            DROP TABLE IF EXISTS `target_type`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `target_type` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              PRIMARY KEY (`id`),
              UNIQUE KEY `name` (`name`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `team`
            --

            DROP TABLE IF EXISTS `team`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `team` (
              `target_id` bigint(20) NOT NULL,
              `manager_id` bigint(20) DEFAULT NULL,
              `director_id` bigint(20) DEFAULT NULL,
              PRIMARY KEY (`target_id`),
              UNIQUE KEY `target_id` (`target_id`),
              KEY `manager_id` (`manager_id`),
              KEY `director_id` (`director_id`),
              CONSTRAINT `team_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`),
              CONSTRAINT `team_ibfk_2` FOREIGN KEY (`manager_id`) REFERENCES `user` (`target_id`),
              CONSTRAINT `team_ibfk_3` FOREIGN KEY (`director_id`) REFERENCES `user` (`target_id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `template`
            --

            DROP TABLE IF EXISTS `template`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `template` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `name` varchar(255) NOT NULL,
              `created` datetime NOT NULL,
              `user_id` bigint(20) NOT NULL,
              PRIMARY KEY (`id`),
              KEY `ix_template_name` (`name`),
              KEY `ix_template_user_id` (`user_id`),
              KEY `ix_template_created` (`created`),
              CONSTRAINT `template_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `template_active`
            --

            DROP TABLE IF EXISTS `template_active`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `template_active` (
              `name` varchar(255) NOT NULL,
              `template_id` int(11) NOT NULL,
              PRIMARY KEY (`name`),
              UNIQUE KEY `template_id` (`template_id`),
              CONSTRAINT `template_active_ibfk_1` FOREIGN KEY (`template_id`) REFERENCES `template` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `template_content`
            --

            DROP TABLE IF EXISTS `template_content`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `template_content` (
              `template_id` int(11) NOT NULL,
              `application_id` int(11) NOT NULL,
              `mode_id` int(11) NOT NULL,
              `subject` varchar(255) NOT NULL,
              `body` text NOT NULL,
              `call` text,
              `sms` text,
              `im` text,
              `email_subject` varchar(255) DEFAULT NULL,
              `email_text` text,
              `email_html` text,
              PRIMARY KEY (`template_id`,`application_id`,`mode_id`),
              KEY `ix_template_content_template_id` (`template_id`),
              KEY `ix_template_content_application_id` (`application_id`),
              KEY `ix_template_content_mode_id` (`mode_id`),
              CONSTRAINT `template_content_ibfk_1` FOREIGN KEY (`template_id`) REFERENCES `template` (`id`),
              CONSTRAINT `template_content_ibfk_2` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`),
              CONSTRAINT `template_content_ibfk_3` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `template_variable`
            --

            DROP TABLE IF EXISTS `template_variable`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `template_variable` (
              `id` int(11) NOT NULL AUTO_INCREMENT,
              `application_id` int(11) NOT NULL,
              `name` varchar(255) NOT NULL,
              `required` tinyint(1) NOT NULL DEFAULT '0',
              `title_variable` tinyint(1) NOT NULL DEFAULT '0',
              PRIMARY KEY (`id`),
              KEY `ix_template_variable_application_id` (`application_id`),
              CONSTRAINT `template_variable_ibfk_1` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `user`
            --

            DROP TABLE IF EXISTS `user`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `user` (
              `target_id` bigint(20) NOT NULL,
              `admin` tinyint(1) unsigned NOT NULL DEFAULT '0',
              PRIMARY KEY (`target_id`),
              CONSTRAINT `user_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `user_setting`
            --

            DROP TABLE IF EXISTS `user_setting`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `user_setting` (
              `user_id` bigint(20) NOT NULL,
              `name` varchar(255) NOT NULL,
              `value` varchar(255) NOT NULL,
              PRIMARY KEY (`user_id`, `name`),
              CONSTRAINT `user_setting_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `user_team`
            --

            DROP TABLE IF EXISTS `user_team`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `user_team` (
              `user_id` bigint(20) NOT NULL,
              `team_id` bigint(20) NOT NULL,
              PRIMARY KEY (`user_id`,`team_id`),
              KEY `ix_user_team_team_id` (`team_id`),
              CONSTRAINT `user_team_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`),
              CONSTRAINT `user_team_ibfk_2` FOREIGN KEY (`team_id`) REFERENCES `team` (`target_id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;


            --
            -- Table structure for table `application_quotas`
            --

            DROP TABLE IF EXISTS `application_quota`;
            CREATE TABLE `application_quota` (
              `application_id` int(11) NOT NULL,
              `hard_quota_threshold` smallint(5) NOT NULL,
              `soft_quota_threshold` smallint(5) NOT NULL,
              `hard_quota_duration` smallint(5) NOT NULL,
              `soft_quota_duration` smallint(5) NOT NULL,
              `plan_name` varchar(255),
              `target_id` bigint(20),
              `wait_time` smallint(5) NOT NULL DEFAULT 0,
              PRIMARY KEY (`application_id`),
              KEY `application_quota_plan_name_fk_idx` (`plan_name`),
              KEY `application_quota_target_id_fk_idx` (`target_id`),
              CONSTRAINT `application_id_ibfk` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `plan_name_ibfk` FOREIGN KEY (`plan_name`) REFERENCES `plan_active` (`name`) ON DELETE SET NULL ON UPDATE CASCADE,
              CONSTRAINT `target_id_ibfk` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE SET NULL ON UPDATE SET NULL
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;


            --
            -- Table structure for table `application_mode`
            --

            DROP TABLE IF EXISTS `application_mode`;
            CREATE TABLE `application_mode` (
              `application_id` int(11) NOT NULL,
              `mode_id` int(11) NOT NULL,
              PRIMARY KEY (`application_id`, `mode_id`),
              CONSTRAINT `application_mode_application_id_ibfk` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `application_mode_mode_id_ibfk` FOREIGN KEY (`mode_id`) REFERENCES `mode` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            --
            -- Table structure for table `application_owner`
            --

            DROP TABLE IF EXISTS `application_owner`;
            CREATE TABLE `application_owner` (
              `application_id` int(11) NOT NULL,
              `user_id` bigint(20) NOT NULL,
              PRIMARY KEY (`application_id`, `user_id`),
              CONSTRAINT `application_owner_application_id_ibfk` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `application_owner_user_id_ibfk` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            --
            -- Table structure for table `twilio_delivery_status`
            --

            DROP TABLE IF EXISTS `twilio_delivery_status`;
            CREATE TABLE `twilio_delivery_status` (
              `twilio_sid` varchar(34) NOT NULL,
              `message_id` bigint(20) DEFAULT NULL,
              `status` varchar(30) DEFAULT NULL,
              PRIMARY KEY (`twilio_sid`),
              KEY `twilio_delivery_status_message_id_fk_idx` (`message_id`),
              CONSTRAINT `twilio_delivery_status_message_id_ibfk` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;


            DROP TABLE IF EXISTS `twilio_retry`;
            CREATE TABLE `twilio_retry` (
              `message_id` bigint(20) NOT NULL,
              `retry_id` bigint(20) NOT NULL,
              PRIMARY KEY (`message_id`),
              KEY `twilio_retry_retry_id_fk_idx` (`retry_id`),
              CONSTRAINT `twilio_retry_message_id_ibfk` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `twilio_retry_retry_id_ibfk` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            --
            -- Table structure for table `incident_emails`
            --

            DROP TABLE IF EXISTS `incident_emails`;
            CREATE TABLE `incident_emails` (
              `email` varchar(255) NOT NULL,
              `application_id` int(11) NOT NULL,
              `plan_name` varchar(255) NOT NULL,
              PRIMARY KEY (`email`),
              KEY `incident_emails_plan_name_fk_idx` (`plan_name`),
              KEY `incident_emails_application_id_fk_idx` (`application_id`),
              CONSTRAINT `incident_emails_application_id_ibfk` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `incident_emails_plan_name_ibfk` FOREIGN KEY (`plan_name`) REFERENCES `plan_active` (`name`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            --
            -- Table structure for table `generic_message_sent_status`
            --

            DROP TABLE IF EXISTS `generic_message_sent_status`;
            CREATE TABLE `generic_message_sent_status` (
              `message_id` bigint(20) NOT NULL,
              `status` tinyint(1) NOT NULL,
              PRIMARY KEY (`message_id`),
              CONSTRAINT `generic_message_sent_status_message_id_ibfk` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            --
            -- Table structure for table `mailing_list`
            --

            DROP TABLE IF EXISTS `mailing_list`;
            /*!40101 SET @saved_cs_client     = @@character_set_client */;
            /*!40101 SET character_set_client = utf8 */;
            CREATE TABLE `mailing_list` (
              `target_id` bigint(20) NOT NULL,
              `count` bigint(20) NOT NULL DEFAULT 0,
              PRIMARY KEY (`target_id`),
              CONSTRAINT `mailing_list_ibfk_1` FOREIGN KEY (`target_id`) REFERENCES `target` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
            /*!40101 SET character_set_client = @saved_cs_client */;

            --
            -- Table structure for table `mailing_list_membership`
            --

            DROP TABLE IF EXISTS `mailing_list_membership`;
            CREATE TABLE `mailing_list_membership` (
              `list_id` bigint(20) NOT NULL,
              `user_id` bigint(20) NOT NULL,
              PRIMARY KEY (`list_id`, `user_id`),
              CONSTRAINT `mailing_list_membership_list_id_ibfk` FOREIGN KEY (`list_id`) REFERENCES `mailing_list` (`target_id`) ON DELETE CASCADE ON UPDATE CASCADE,
              CONSTRAINT `mailing_list_membership_user_id_ibfk` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;


            DROP TABLE IF EXISTS `device`;
            CREATE TABLE `device` (
              `id` BIGINT(20) NOT NULL AUTO_INCREMENT,
              `registration_id` VARCHAR(255) NOT NULL UNIQUE,
              `user_id` BIGINT(20) NOT NULL,
              `platform` VARCHAR(255) NOT NULL,
              PRIMARY KEY (`id`),
              CONSTRAINT `device_user_id_ibfk` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;


            DROP TABLE IF EXISTS `application_stats`;
            CREATE TABLE `application_stats` (
              `application_id` INT(11) NOT NULL,
              `statistic` VARCHAR(255) NOT NULL,
              `value` FLOAT NOT NULL,
              `timestamp` DATETIME NOT NULL,
              PRIMARY KEY (`application_id`, `statistic`),
              CONSTRAINT `application_stats_app_id_ibfk` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`)
                ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            DROP TABLE IF EXISTS `global_stats`;
            CREATE TABLE `global_stats` (
              `statistic` VARCHAR(255) NOT NULL,
              `value` FLOAT NOT NULL,
              `timestamp` DATETIME NOT NULL,
              PRIMARY KEY (`statistic`)
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            DROP TABLE IF EXISTS `comment`;
            CREATE TABLE `comment` (
              `id` BIGINT(20) NOT NULL AUTO_INCREMENT,
              `incident_id` BIGINT(20) NOT NULL,
              `created` DATETIME NOT NULL,
              `user_id` BIGINT(20) NOT NULL,
              `content` TEXT NOT NULL,
              PRIMARY KEY (`id`),
              CONSTRAINT `comment_incident_id_ibfk` FOREIGN KEY (`incident_id`) REFERENCES `incident` (`id`),
              CONSTRAINT `comment_user_id_ibfk` FOREIGN KEY (`user_id`) REFERENCES `user` (`target_id`) ON DELETE CASCADE ON UPDATE CASCADE
            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

            /*!40101 SET character_set_client = @saved_cs_client */;
            /*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

            /*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
            /*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
            /*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
            /*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
            /*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
            /*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
            /*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

            -- Dump completed on 2016-09-28 11:52:18
          1_schema.sql: |
            USE iris;

            CREATE TABLE IF NOT EXISTS `access_token` (
              `id` BIGINT(20) NOT NULL AUTO_INCREMENT,
              `user_id` bigint(20) NOT NULL,
              `key` varchar(255) NOT NULL UNIQUE,
              `expiration` BIGINT(20) UNSIGNED NOT NULL,
              PRIMARY KEY (`id`),
              KEY `access_user_idx` (`user_id`),
              CONSTRAINT `access_user_id_fk` FOREIGN KEY (`user_id`) REFERENCES `target` (`id`)
            );

            CREATE TABLE IF NOT EXISTS `refresh_token` (
              `id` BIGINT(20) NOT NULL AUTO_INCREMENT,
              `user_id` bigint(20) NOT NULL,
              `key` varchar(255) NOT NULL UNIQUE,
              `expiration` BIGINT(20) UNSIGNED NOT NULL,
              PRIMARY KEY (`id`),
              KEY `refresh_user_idx` (`user_id`),
              CONSTRAINT `refresh_user_id_fk` FOREIGN KEY (`user_id`) REFERENCES `target` (`id`)
            );

            CREATE TABLE IF NOT EXISTS `saml_id` (
              `id` VARCHAR(255) NOT NULL,
              `timestamp` BIGINT(20) UNSIGNED NOT NULL,
              PRIMARY KEY (`id`)
            );

      -
        kind: Service
        apiVersion: v1
        metadata:
          name: my-service
        spec:
          selector:
            name: app
          ports:
          - protocol: TCP
            port: 16649
            targetPort: 16649
